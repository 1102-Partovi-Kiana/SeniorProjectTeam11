{% extends "base.html" %}

{% block title %}
    <title>Environment</title>
{% endblock %}

{% block header %}
<header id="header">
    <div class="navbar navbar-ware-env justify-content-start">
        <a class="ware-icon rounded px-1 px-md-2 py-1 py-md-2 mr-2" href="#">
            <svg class="bi text-white" fill="currentColor">
                <!-- Use a static icon reference instead of dynamic url_for -->
                <use xlink:href="/static/img/bootstrap-icons.svg#joystick" />
            </svg>
        </a>
        <div class="environment-info">
            <h1 class="environment-name">Environment Name</h1>
            <p class="environment-note">Brief description of the environment.</p>
        </div>
        <div class="dropdown ml-auto">
            <a class="btn-link dropdown-toggle text-white px-3 py-2" id="userDropdown" data-toggle="dropdown" href="#"
               aria-haspopup="true" aria-expanded="false">User Name</a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
                <a class="dropdown-item d-flex align-items-center" href="#">
                    <svg class="bi mr-2" height="20" width="20" fill="currentColor">
                        <!-- Static icon link -->
                        <use xlink:href="/static/img/bootstrap-icons.svg#grid" />
                    </svg>
                    Environments
                </a>
                <a class="dropdown-item d-flex align-items-center" href="#">
                    <svg class="bi mr-2" height="20" width="20" fill="currentColor">
                        <use xlink:href="/static/img/bootstrap-icons.svg#gear-wide-connected" />
                    </svg>
                    Settings
                </a>
                <a class="dropdown-item d-flex align-items-center" href="#">
                    <svg class="bi mr-2" height="20" width="20" fill="currentColor">
                        <use xlink:href="/static/img/bootstrap-icons.svg#box-arrow-right" />
                    </svg>
                    Log out
                </a>
            </div>
        </div>
    </div>
    <div class="mobile-nav-bar d-flex d-lg-none justify-content-center py-2">
        <div class="btn-group d-inline-flex d-lg-none" role="group">
            <button class="btn btn-code active py-1">Python</button>
            <button class="btn btn-results py-1">Video & Shell</button>
        </div>
    </div>
</header>
{% endblock %}

{% block extra_css %}
    <!-- Include CodeMirror core stylesheet and Monokai theme -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">

    <!-- Custom styles -->
    <style>
        .environment-container {
            background-color: #1e1f26;
        }

        .col-form {
            height: calc(100vh - 72px);
            border-top: 2px solid #444857;
            border-right: 2px solid #444857;
        }
        .col-form .environment-lang {
            font-size: 20px;
        }

        .code-wrapper {
            height: calc(100% - 104px);
            background-color: #282a36;
        }
        .code-wrapper .CodeMirror {
            height: 100%;
            font-size: 14px;
        }

        .button-row {
            font-size: 16px;
            font-weight: 400;
        }

        .btn-submit {
            background-color: #47cf73;
            border-color: #47cf73;
        }

        .input-group {
            width: 55%;
        }
        .input-group .custom-file .custom-file-label {
            color: #fff;
            background-color: #282a36;
        }

        .col-output {
            display: flex;
        }

        .visual {
            height: 450px;
            background-color: #73dc92;
        }

        .shell-wrapper {
            background-color: #282a36;
        }
    </style>
{% endblock %}

{% block body %}
<section class="environment-container">
    <div class="container-fluid">
        <div class="row">
            <!-- Left Column: Code Editor -->
            <div class="col-12 col-lg-6 col-xl-7 col-form px-0">
                <form class="d-flex flex-column h-100" id="form-submit">
                    <div class="d-none d-lg-block mb-1 ml-3 environment-lang" style="font-weight: 600; color: #a9afbc;">
                        Python
                    </div>

                    <div class="code-wrapper flex-grow-1">
                        <textarea class="code w-100 h-100 form-control" id="code" name="code"
                                  autofocus>Type your code here...</textarea>
                    </div>
                    <div class="button-row d-flex flex-column flex-lg-row mx-0 mx-lg-4 my-0 my-lg-3 align-items-center">
                        <div class="input-group ml-lg-0 order-2 order-lg-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Upload Code</span>
                            </div>
                            <div class="custom-file">
                                <input class="custom-file-input" id="uploadCode" type="file">
                                <label class="custom-file-label" for="uploadCode">Choose file</label>
                            </div>
                        </div>
                        <button class="btn btn-submit px-3 px-lg-4 ml-auto d-flex align-items-center order-1 order-lg-2 mb-2 mb-lg-0" id="submit-btn" type="button">
                            Run
                        </button>
                    </div>
                </form>
            </div>

            <!-- Right Column: Video and Output -->
            <div class="col-lg-6 col-xl-5 flex-column col-output pr-0">
                <!-- Video Section -->
                <div class="visual embed-responsive embed-responsive-4by3">
                    <video id="video" width="511" height="511" controls muted>
                        <source src="/static/sample_video.mp4" type="video/mp4">
                        Video cannot be played.
                    </video>
                </div>

                <!-- Terminal Output Section -->
                <div class="shell-wrapper d-flex flex-column flex-grow-1 mt-3">
                    <textarea class="Output w-100 h-100 form-control" id="shell" rows="5" disabled>Terminal Output Here</textarea>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
    <!-- Include CodeMirror JS and Python mode -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>

    <!-- Initialize CodeMirror -->
    <script>
        var editor = CodeMirror.fromTextArea(document.getElementById('code'), {
            lineNumbers: true,
            mode: 'python',
            theme: 'monokai',
            viewportMargin: Infinity
        });
    </script>
{% endblock %}

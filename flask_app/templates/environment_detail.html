{% extends "base.html" %}

{% block title %}
<title>Robotic Environment</title>
{% endblock %}

{% block body %}
<section>
    <div class="container-fluid">
        <div class="row d-flex">
            <!-- Code editor on the left -->
            <div class="col-md-6" style="margin-top: 200px;">
                <div class="code-editor">
                    <h4>Python Code Editor</h4>
                    <textarea id="code-editor" rows="20">
ball_position = current_env.get_ball_position()
gripper_position = current_env.get_gripper_position()
direction = np.array(ball_position) - np.array(gripper_position)
distance_threshold = 0.01
step_size = 0.05

while np.linalg.norm(direction) > distance_threshold:
    action = np.append(direction / np.linalg.norm(direction) * step_size, [1])
    
    current_env.step(action)
    
    gripper_position = current_env.get_gripper_position()
    direction = np.array(ball_position) - np.array(gripper_position)

print("Final Gripper Position:", gripper_position)
print("Reached near the ball.")
                    </textarea>
                </div>
            </div>

            <!-- Video player on the right -->
            <div class="col-md-6 d-flex justify-content-center align-items-center" style="margin-top: 200px;">
                <div class="video-container">
                    <img src="{{ url_for('video_feed') }}" width="100%">
                </div>
            </div>
        </div>

        <!-- File upload and Run button at the bottom -->
        <div class="row mt-4">
            <div class="col-md-6">
                <input type="file" id="file-upload" class="form-control">
            </div>
            <div class="col-md-6 text-right">
                <button id="run-code" class="btn btn-success">Run</button>
            </div>
        </div>
    </div>
</section>

<script>
    document.getElementById('run-code').addEventListener('click', function() {
        const code = document.getElementById('code-editor').value;

        const formData = new FormData();
        formData.append('code', code);

        fetch('/run-code', {
            method: 'POST',
            body: formData,
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
        });
    });
</script>

{% endblock %}
